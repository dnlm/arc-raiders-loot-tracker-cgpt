name: Arc Raiders – Loot table scraper
# Runs daily at 03:27 Europe/Berlin ≈ 02:27 UTC in winter, 01:27 UTC in summer.
# GitHub cron uses **UTC**; the two lines below cover DST shifts.
- cron: "27 2 * 10-3 *" # Oct–Mar (CET) → 03:27 Berlin == 02:27 UTC
- cron: "27 1 * 4-9 *" # Apr–Sep (CEST) → 03:27 Berlin == 01:27 UTC


permissions:
contents: write


jobs:
scrape:
runs-on: ubuntu-latest
steps:
- name: Checkout
uses: actions/checkout@v4


- name: Set up Python
uses: actions/setup-python@v5
with:
python-version: '3.11'


- name: Install dependencies
run: |
python -m pip install --upgrade pip
pip install -r requirements.txt


- name: Run scraper (manual dispatch)
if: github.event_name == 'workflow_dispatch'
env:
FORCE_REFETCH: ${{ github.event.inputs.force }}
BASE_URL: https://arcraiders.wiki
LOOT_PATH: /wiki/Loot
run: |
python scripts/arc_loot_scraper.py --base-url "$BASE_URL" --loot-path "$LOOT_PATH" \
--out-json docs/data.json --out-csv docs/data.csv --out-md docs/data.md


- name: Run scraper (scheduled daily, force refetch)
if: github.event_name == 'schedule'
env:
FORCE_REFETCH: true
BASE_URL: https://arcraiders.wiki
LOOT_PATH: /wiki/Loot
run: |
python scripts/arc_loot_scraper.py --base-url "$BASE_URL" --loot-path "$LOOT_PATH" \
--out-json docs/data.json --out-csv docs/data.csv --out-md docs/data.md


- name: Commit results
run: |
git config user.name "github-actions"
git config user.email "github-actions@users.noreply.github.com"
git add docs/data.*
git add docs/index.html
git add README.md
if ! git diff --cached --quiet; then
git commit -m "chore: daily Arc Raiders loot update [skip ci]"
git push
else
echo "No changes"
fi


- name: Upload artifact (CSV/JSON/MD)
uses: actions/upload-artifact@v4
with:
name: arc-loot-data
path: |
docs/data.json
docs/data.csv
docs/data.md